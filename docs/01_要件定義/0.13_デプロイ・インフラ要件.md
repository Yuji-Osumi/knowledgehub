# 0.13 デプロイ・インフラ要件（最終確定版）

## 1. 基本方針

- 個人開発・MVP前提で「シンプル・事故が少ない構成」を最優先
- 可用性・冗長化よりも **理解しやすさ・運用しやすさ** を重視
- 初期は 1ユーザー想定のため、スケール対応は考慮しない

---

## 2. 環境構成

### 環境種別

- local：ローカル開発環境
- production：本番環境

※ staging / QA 環境は作成しない（MVPとして割り切る）

---

## 3. フロントエンドのデプロイ方式（確定）



- フロントエンド・バックエンドともに Railway にデプロイ
- APIとフロントは **同一ドメイン or サブドメイン配下** とする

**採用理由**

- Cookieベース認証がシンプルに成立する
- CORS / SameSite / Secure の事故を回避できる
- 個人開発・MVPとして最もトラブルが少ない

---

## 4. バックエンド構成

- FastAPI（Dockerコンテナ）
- Railway 上で Docker デプロイ
- リバースプロキシは Railway 側に委譲
- HTTPS / SSL は Railway 標準機能を利用

---

## 5. データベース構成

- PostgreSQL（Railway マネージドDB）
- 接続情報は環境変数で管理
- アプリからは ORM（SQLAlchemy）経由で操作

---

## 6. 環境変数と設定管理

### 方針

- 機密情報はすべて環境変数で管理
- local と production の2環境のみ対応
- 設定値はアプリ内の設定クラスから一元参照する

### バックエンド（例）

- DATABASE_URL
- SESSION_SECRET
- COOKIE_SECURE
- COOKIE_SAMESITE
- APP_ENV

### フロントエンド（例）

- VITE_API_BASE_URL

※ `.env` ファイルは git 管理しない

---

## 7. DBマイグレーション運用

- Alembic を使用
- スキーマ変更時は必ずマイグレーションを作成
- ローカルで適用 → 本番に適用の単純なフロー
- 本番ロールバックは原則行わない（必要時は手動対応）

---

## 8. ログ・監視

- アプリログは標準出力に出力
- Railway のログ閲覧機能を利用
- 外部監視・アラートツールは導入しない

---

## 9. バックアップとデータ保護

- DBバックアップは Railway のマネージド機能に依存
- アプリ側での自動バックアップは行わない
- 重要データは必要に応じて手動エクスポートする

---

## 10. 障害時の割り切り（精神安定）

- 24時間稼働・即時復旧は目標としない
- 障害時は原因調査 → 手動復旧を基本とする
- SLA・可用性保証は考慮しない
- 「壊れたら直す」前提で過剰な対策は行わない

---

## 11. 非対応・将来検討事項

- マルチリージョン対応
- オートスケーリング
- 高可用性構成
- 高度な監視・アラート
- 設定管理基盤（Vault 等）

※ いずれも MVP 完了後の拡張対象とする
