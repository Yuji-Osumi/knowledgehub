# 0.4 認証・セキュリティ技術選定理由（評価項目付き）

---

## 1. Session + Cookie 認証

- **採用理由**
  - MVP のシンプルさとセキュリティを最優先
  - サーバー側でセッション管理可能で強力なログイン制御ができる
  - トークン盗難時の即座の無効化が可能
  - 個人利用規模では十分なセキュリティ水準
- **評価項目**
  - 実装容易性（ログイン・ログアウト）
  - セキュリティ（セッション保護・即座の無効化可能）
  - 拡張性（Phase 2 でのデータ分析に対応可）
  - MVP工数（低）

---

## 2. JWT認証（JSON Web Token）

- **採用理由（将来の参考）**
  - ステートレス設計でサーバー負荷が少ない
  - 複数サーバー間での検証が容易
  - モバイル アプリケーション対応時に有利
- **評価項目**
  - 実装容易性（ログイン・ログアウト）
  - セキュリティ（トークン署名・ブラックリスト管理）
  - 拡張性（マイクロサービス対応）
  - MVP工数（中）

---

## 3. Cookieセッション認証（従来型）

- **採用理由**
  - サーバー側でセッション管理可能で簡単にログイン制御できる
  - CSRF対策などセキュリティ機構を組み込みやすい
- **評価項目**
  - 実装容易性（ログイン・ログアウト）
  - セキュリティ（セッション保護・CSRF対策）
  - 拡張性（OAuth2連携可）
  - MVP工数（中）

---

## 4. OAuth2 / 外部認証（Google, GitHub 等）

- **採用理由**
  - パスワード管理不要でセキュア
  - 外部アカウントで認証できるため利便性が高い
- **評価項目**
  - 実装容易性（初期設定やエラー対応）
  - セキュリティ（外部プロバイダに依存）
  - 拡張性（複数プロバイダ追加可能）
  - MVP工数（高）

---

## 5. Firebase Authentication（BaaS）

- **採用理由**
  - クラウドサービスによる認証で実装工数が低い
  - メール認証やソーシャルログインに対応可能
- **評価項目**
  - 実装容易性（API呼び出しだけで簡単に導入）
  - セキュリティ（クラウド依存）
  - 拡張性（ソーシャルログイン対応）
  - MVP工数（低〜中）

---

## 5. 個人開発MVP向け総括

- **最小工数で自前管理 → JWT + bcrypt**
- **サーバーサイドで簡単管理 → Cookieセッション**
- **外部連携で豪華に見せる → OAuth2 / Firebase（MVPでは非推奨）**

---

## 6. 最終採用：Session + Cookie 方式

### 採用理由

MVP のシンプルさとセキュリティを優先し、**Session + Cookie** 認証を採用する。

#### **Session を選択した理由**

1. **セキュリティの高さ**
   - トークン盗難時にサーバー側で即座に無効化可能
   - ブラウザが閉じられた場合も自動的にセッション削除
   - ログアウト処理が直感的（Redis から削除するだけ）

2. **実装の簡潔さ**
   - JWT の署名生成・検証ロジックが不要
   - セッション ID の生成と保存のみ
   - デバッグが容易（Redis でセッション内容が見える）

3. **MVP に適切**
   - 個人利用・シングルサーバー前提
   - 複雑さの増加が最小限
   - 将来 JWT への移行も容易（Phase 2 で検討可能）

#### **Cookie に保存する理由**

1. **XSS 対策**
   - HttpOnly Cookie により JavaScript からのアクセス不可
   - localStorage に保存する方式より安全

2. **実装の簡潔さ**
   - ブラウザが自動的に Cookie を送信
   - フロントエンドで Authorization ヘッダー管理不要

3. **CSRF 対策**
   - SameSite=Lax により基本的な CSRF を防御

#### **トレードオフの認識**

- トークン無効化に Redis ブラックリストが必要（完全なステートレスではない）
- ログアウト時の即座無効化とのバランスを取った設計

### 実装スコープ

**MVP：**
- アクセストークンのみ（24時間有効）
- ブラックリスト方式のトークン無効化
- bcrypt によるパスワードハッシュ

**Phase 2 以降：**
- リフレッシュトークン実装（1時間 + 7日間）
- 自動ログイン UX の向上
- トークン有効期限の短縮
