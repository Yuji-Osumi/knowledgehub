# 作業振り返り・フィードバック（2026-01-29）

## 1. 良かった点

### ① テストの自動化基盤を整備できた

* `backend/scripts/test_articles_api.py` を新規作成
* Article API の **201・422・404・500** の各ステータスコードを自動検証
* テスト後に自動クリーンアップ（DELETE） → テストの冪等性が確保される
* Makefile に `make article-api-test` を追加 → 実行が簡単に

👉 **日報の「確認できている」が実装・可視化された** - これが重要

### ② OpenAPI ドキュメント（Swagger UI）の質が大幅に向上

* `schemas/common.py` を新規作成 → エラーレスポンス形式を統一
* `api/articles.py` の responses に **example を明示的に記載**
* Swagger UI の「Example Value」と実際のレスポンスが **完全一致**
* FastAPI 標準スタイルに準拠 → 保守性が高い

👉 API ドキュメント = 信頼できるリファレンス

### ③ 設計判断が実務的だった

* **トランザクションロールバック（案2）** の問題を早期に発見
  - curl では rollback が機能しないことに気づいた
  - 結果として **案3（テスト後クリア）** で正しく実装

* **responses の example** - schema と responses の二重管理問題
  - 最初は schema の `json_schema_extra` を使用
  - 不一致が生じて、responses に統一 → FastAPI 標準スタイルに収束

👉 「実装 → 検証 → 改善」のサイクルが回っている

### ④ WSL 環境への適応が素早かった

* `requests` パッケージを `requirements-dev.txt` に追加（正確な判断）
* 開発ツール（ruff/mypy）と同じ層で管理 → 環境構成が整理されている

---

## 2. 改善できそうな点


### ② responses の記述が長い（FastAPI 標準スタイルだが可読性低下）

* 5つのエンドポイント × 複数のステータスコード定義 → api/articles.py が長くなる
* 方法2（responses を定数として分離）の検討を先延ばしにした

👉 ファイル行数が 300 行を超える場合は、定数分離を検討する基準を設ける

---

## 3. 次回への提案

### 優先度高（自然な次ステップ）

1. **openapi.json の自動更新スクリプト化**
   - `scripts/update_openapi.py` を作成
   - `make update-openapi` コマンド追加
   - GitHub Pages で公開される docs が常に最新

2. **テストファイル（test_articles_api.py）の pytest 化**
   - 現在は独立実行スクリプト
   - pytest フレームワークに統合 → CI/CD に組み込めた状態に

3. **論理削除（is_valid）の一覧・詳細取得への反映**
   - 現在：DELETE で `is_valid = False` に
   - 課題：GET (一覧) で `is_valid = True` のフィルタがない
   - 削除した記事が一覧に表示されてしまう

### 優先度中（品質向上）

4. **認証の導入**
   - `get_current_user()` の実装
   - USER_ID = 1 の撤廃
   - created_by / updated_by の自動注入

5. **エラーレスポンス形式の統一仕上げ**
   - FastAPI 標準の 422 と独自 ErrorResponse の住み分けが曖昧
   - 例）404 は ErrorResponse、422 は FastAPI 標準 → 統一する

---

## 4. 総括

今日の作業は、**「実装の検証を自動化する」** ことに徹した 1 日でした。

### 実績
- ✅ Article API テスト（4/4 PASS）
- ✅ OpenAPI ドキュメント充実化
- ✅ テストデータの自動クリーンアップ
- ✅ Swagger UI の「Example Value」が正確化

### 質

特に良いのは：

* **「確認できている」を実装・可視化した**
  - 日報に書いた 422・500・201 を実際にテストできるようにした
  - これが**技術的負債を増やさない** ポイント

* **設計判断が実務的**
  - トランザクション問題を早期発見
  - responses の二重管理問題を FastAPI 標準に統一
  - 「動く」から「正しく動く」への進化

* **ドキュメント = コード**
  - OpenAPI/Swagger がもはや「装飾」ではなく、**API の仕様書そのもの**
  - クライアント開発者が迷わない設計

### 次への構え

現在のレベルなら、**認証実装への準備は整っている**。
- テスト基盤 ✅
- ドキュメント ✅
- エラーハンドリング ✅

あとは、`get_current_user()` という **パイプライン** を通すだけで、
全エンドポイントが自動的に認証化される構造。

次回は **認証に行こう**。それまでに openapi.json の自動更新だけやっておくといい。

---
